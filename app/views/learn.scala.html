@import model.{CardType, Flashcard, User, UserAnsweredFlashcard, Correctness}

@(user: User, flashcard: Flashcard, oldAnswer: Option[UserAnsweredFlashcard], isRepeating: Boolean)(
    implicit requestHeader: RequestHeader, messagesProvider: MessagesProvider
)

    @title = @{
        "Vokabeln " + (if(isRepeating) "wiederholen" else "Lernen")
    }

    @scripts = {
        <script src="@routes.Assets.versioned("scripts/learn.js")"></script>
    }

    @choiceInputType = @{
        flashcard.choiceAnswers.count(_.correctness != Correctness.Wrong) match {
            case 1 => "radio"
            case _ => "checkbox"
        }
    }

    @main(title, Some(user), scripts) {
        @helper.CSRF.formField

        <div class="row">
            <div class="col s12 l8 offset-l2" id="flashcardDiv" data-cardtype="@flashcard.cardType">
                <div class="card-panel">
                    <h4 class="center-align">@flashcard.question @flashcard.questionHint.map(h => Html(s"<i>$h</i>")).getOrElse(Html(""))</h4>
                </div>

                <p class="center-align">
                    <code>
                        Stapel: @oldAnswer.map(_.bucket).getOrElse(1), Versuche: <span id="triesSpan">@oldAnswer.map(_.tries).getOrElse(0)</span></code>
                </p>

                @flashcard.cardType match {
                    case CardType.Text | CardType.Vocable => {
                        <div class="row">
                            <div class="input-field col s12">
                                <input type="text" id="translation_input" autofocus autocomplete="off">
                                <label for="translation_input">Übersetzung</label>
                            </div>
                        </div>
                    }

                    case CardType.Blank => {
                        @for(blanksAnswer <- flashcard.blanksAnswers) {
                            <div class="row">
                                <div class="input-field col s12">
                                    <input type="text" id="blanksInput_@blanksAnswer.answerId" autofocus autocomplete="off">
                                    <label for="blanksInput_@blanksAnswer.answerId">Übersetzung</label>
                                </div>
                            </div>
                        }
                    }

                    case CardType.Choice => {
                        @for(answer <- scala.util.Random.shuffle(flashcard.choiceAnswers)) {
                            <p>
                                <label for="choice_@answer.answerId">
                                    <input id="choice_@answer.answerId" name="choice_answers" type="@choiceInputType" data-choiceid="@answer.answerId">
                                    <span>@answer.answer</span>
                                </label>
                            </p>
                        }
                    }
                }

                <p id="correctionTextPar">&nbsp;</p>

                <button class="btn btn-large waves-effect @primaryColor" onclick="checkSolution();" id="checkSolutionBtn"
                data-cardId="@flashcard.cardId" data-collid="@flashcard.collId" data-courseid="@flashcard.courseId"
                data-href="@routes.HomeController.checkSolution">Lösung testen</button>

                <a href="@routes.HomeController.startLearning(flashcard.courseId, flashcard.collId, isRepeating)"
                id="nextFlashcardBtn" class="btn btn-large waves-effect @accentColor disabled">Weiter</a>

            </div>
        </div>
    }

